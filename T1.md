# Tema 1: Rendiment i Consum

## 1.2 Mesures de rendiment

### 1.2.1 Conceptes i mètriques
- **Temps d’execució:** temps transcorregut entre l’inici i el final d’una tasca.
  - *Exemple:* Temps de resposta d’una app.
- **Productivitat (Throughput):** Nombre de tasques completades per unitat de temps.
  - *Exemple:* Jobs per hora en un centre de càlcul.
- Ens centrarem en **temps d’execució**:  
\[
  \text{texe} = \text{tcpu} + \text{temps d’E/S} + \text{temps altres programes}
\]
  Assumint que \text{texe} = \text{tcpu}.

### 1.2.2 Càlcul del temps d’execució (de CPU)
- **Fórmula bàsica**:  
\[
  \text{texe} = \text{ncicles} \times \text{tc}
\]
\[
  \text{tc} = \frac{1}{fclock}
\]
- **Exemple**: Si fclock = 2GHz, llavors  
\[
  \text{tc} = \frac{1}{2 \times 10^9} = 0.5ns
\]

- **Com determinar \text{ncicles}?**  
\[
  \text{ncicles} = I \times CPI
\]
\[
  \text{ncicles} = IA \times CPIA + IB \times CPIB + IC \times CPIC
\]
  
  Exemple de càlcul:
  | Tipus instrucció | I (\times 10^9) | CPI |
  |-----------------|----------------|-----|
  | A               | 2              | 1   |
  | B               | 1              | 2   |
  | C               | 2              | 3   |

\[
  \text{ncicles} = (2 \times 1 + 1 \times 2 + 2 \times 3) \times 10^9 = 10 \times 10^9
\]
\[
  \text{texe} = 10 \times 10^9 \times 0.5 \times 10^{-9} = 5s
\]

### 1.2.3 Núm de cicles vs Freqüència de rellotge
- Reduir el temps de cicle pot incrementar el CPI, fent que certes instruccions triguen més.
- *Exemple:* Reducció de temps de cicle de 1ns a 0.6ns pot fer que instruccions que trigaven 1 cicle, ara en necessitin 2.

## 1.3 Llei d’Amdahl
- Suposem una tasca amb temps original t_{original}.
- Una fracció P_x pot millorar-se S_x vegades.
- *Fórmula de speedup global*:
\[
  s = \frac{1}{\frac{P_x}{S_x} + (1 - P_x)}
\]
- *Exemple:* Un programa 90% paral·lelitzable en 3 ordinadors:
\[
  s = \frac{1}{\frac{0.9}{3} + 0.1} = \frac{1}{0.4} = 2.5
\]

- *Límit teòric*: Si S_x \to \infty,
\[
  s_{max} = \frac{1}{1 - P_x}
\]
  *Exemple:* Programa 90% paral·lelitzable,
\[
  s_{max} = \frac{1}{0.1} = 10
\]

- **Conclusió**: Cal optimitzar les parts que consumeixen més temps.

## 1.4 Mesures de consum

### 1.4.1 Càlcul del consum dinàmic
- **Consum dinàmic d’un circuit CMOS**:
\[
  P = C \times V^2 \times f_{commut}
\]
  On:
  - C = capacitat agregada (farads)
  - V = voltatge (volts)
  - f_{commut} = f_{clock} \times \alpha (factor d'activitat)

- **Exemple (Examen 2016/2017 Q2)**:
  - CPU de mòbil, potència dissipada: 16W, bateria: 500J.
  - Executa un test en 30s:
  
  | Tipus instrucció | I (\times 10^9) | CPI |
  |-----------------|----------------|-----|
  | A               | 6              | 1   |
  | B               | 2              | 2   |
  | C               | 4              | 5   |
  | D               | 3              | 4   |

\[
  ncicles = (6 \times 1 + 2 \times 2 + 4 \times 5 + 3 \times 4) \times 10^9 = 42 \times 10^9
\]
\[
  f = \frac{42}{30} \times 10^9 = 1.4GHz
\]

  - Energia restant:
\[
    E = 16 \times 30 = 480J \Rightarrow 500J - 480J = 20J
\]
\[
    t = \frac{20}{16} = 1.25s
\]

### 1.4.2 Consum estàtic
- **Corrents de fuga** I_{leak}:
  - No depèn de l'activitat del processador.
  - Augmenta exponencialment si baixa V_t (tensió umbral).
  - *Problema*: Si V_t = 0.2V, el consum estàtic pot ser el 50% del total.

### 1.4.3 Tècniques de reducció de consum
- **Clock gating**: Desactiva rellotge en parts inactives.
- **Dynamic Voltage and Frequency Scaling (DVFS)**: Redueix V i f.
- **Power gating**: Apaga parts del circuit (nuclis CPU, cache).
- **High-k materials**: Redueix I_{leak} amb nous materials aïllants.

---

## **Conclusió**
- Per millorar el **rendiment**, cal optimitzar les parts més costoses en temps.
- La **Llei d'Amdahl** defineix límits teòrics d'acceleració.
- L'augment de **freqüència** millora rendiment però incrementa **consum**.
- El **consum dinàmic** es pot calcular amb P = C \times V^2 \times f.
- L'ús de tècniques com **clock gating, DVFS i power gating** ajuda a reduir el consum.